{"version":3,"sources":["app/application.js","app/collections/plugs.js","app/collections/sharingRules.coffee","app/initialize.js","app/lib/base_view.coffee","app/lib/view_collection.coffee","app/models/device.js","app/models/plug.js","app/models/sharingRule.coffee","app/router.coffee","app/templates/addSharingRule.jade","app/templates/home.jade","app/templates/sharingRule.jade","app/views/addSharingRuleView.coffee","app/views/app_view.coffee","app/views/contact-list.coffee","app/views/sharingRuleView.coffee"],"names":[],"mappings":"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AAC,MAAM,MAAK,CAAC,GAAN,CAAP,GAAoB,IAAI,CAAC,MAAL,EAFpB;AAAA,IAGA,IAAC,WAAD,CAAY,IAAZ,CAHA;WAIA,IAAC,SAAD,CAAU,IAAC,MAAX,EALK;EAAA,CApDT;;AAAA,2BA4DA,aAAY,SAAC,KAAD;AACR,QAAC,MAAM,MAAK,CAAC,GAAN,CAAU,CAAC,MAAlB;AAAA,IACA,WAAQ,MAAM,MAAK,CAAC,GAAN,CADd;WAGA,IAAC,SAAD,CAAU,IAAC,MAAX,EAJQ;EAAA,CA5DZ;;wBAAA;;GAF0C,SAf9C;;;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A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","file":"public/scripts/app.js","sourcesContent":["module.exports = {\n\n    initialize: function() {\n        var Router = require('router');\n        this.router = new Router();\n        Backbone.history.start();\n    }\n};","Plug = require('../models/plug');\nmodule.exports = Plugs = Backbone.Collection.extend({\n    model: Plug,\n    url: 'insert',\n});","SharingRule = require '../models/sharingRule'\n\nmodule.exports = class SharingRuleCollection extends Backbone.Collection\n\n    # Model that will be contained inside the collection.\n    model: SharingRule\n\n    # This is where ajax requests the backend.\n    url: 'sharingrule'\n","// The function called from index.html\n$(document).ready(function() {\n    var app = require('application');\n    app.initialize()\n});\n","module.exports = class BaseView extends Backbone.View\n\n    template: ->\n\n    initialize: ->\n\n    getRenderData: ->\n        model: @model?.toJSON()\n\n    render: ->\n        @beforeRender()\n        @$el.html @template(@getRenderData())\n        @afterRender()\n        @\n\n    beforeRender: ->\n\n    afterRender: ->\n\n    destroy: ->\n        @undelegateEvents()\n        @$el.removeData().unbind()\n        @remove()\n        Backbone.View::remove.call @\n","BaseView = require 'lib/base_view'\n\n# View that display a collection of subitems\n# used to DRY views\n# Usage : new ViewCollection(collection:collection)\n# Automatically populate itself by creating a itemView for each item\n# in its collection\n\n# can use a template that will be displayed alongside the itemViews\n\n# itemView       : the Backbone.View to be used for items\n# itemViewOptions : the options that will be passed to itemViews\n# collectionEl : the DOM element's selector where the itemViews will\n#                be displayed. Automatically falls back to el if null\n\nmodule.exports = class ViewCollection extends BaseView\n\n    itemview: null\n\n    views: {}\n\n    template: -> ''\n\n    itemViewOptions: ->\n\n    collectionEl: null\n\n    # add 'empty' class to view when there is no subview\n    onChange: ->\n        @$el.toggleClass 'empty', _.size(@views) is 0\n\n    # can be overriden if we want to place the subviews somewhere else\n    appendView: (view) ->\n        @$collectionEl.append view.el\n\n    # bind listeners to the collection\n    initialize: ->\n        super\n        @views = {}\n        @listenTo @collection, \"reset\",   @onReset\n        @listenTo @collection, \"add\",     @addItem\n        @listenTo @collection, \"remove\",  @removeItem\n\n        if not @collectionEl?\n            collectionEl = el\n\n    # if we have views before a render call, we detach them\n    render: ->\n        view.$el.detach() for id, view of @views\n        super\n\n    # after render, we reattach the views\n    afterRender: ->\n        @$collectionEl = $(@collectionEl)\n        @appendView view.$el for id, view of @views\n        @onReset @collection\n        @onChange @views\n\n    # destroy all sub views before remove\n    remove: ->\n        @onReset []\n        super\n\n    # event listener for reset\n    onReset: (newcollection) ->\n        view.remove() for id, view of @views\n        newcollection.forEach @addItem\n\n    # event listeners for add\n    addItem: (model) =>\n        options = _.extend {}, {model: model}, @itemViewOptions(model)\n        view = new @itemview(options)\n        @views[model.cid] = view.render()\n        @appendView view\n        @onChange @views\n\n    # event listeners for remove\n    removeItem: (model) =>\n        @views[model.cid].remove()\n        delete @views[model.cid]\n\n        @onChange @views\n","module.exports = Device = Backbone.Model.extend({\n\turl: '',\n\tdefaults: {\n\t\tpassword: null,\n\t\ttarget: null,\n\t\tdevicename: null, \n\t\tstatus: null\n\t}\n});","module.exports = Plug = Backbone.Model.extend({\n    urlRoot: 'plug',\n    defaults: {\n        nDocs: null,\n        baseName:null,\n        status: null,\n        devicename: null,\n        target: null,\n        password: null,\n        dataType: null,\n        auth: false,\n        init: false,\n        ids: null\n    },\n\n    replicate: function(callback) {\n        $.ajax({\n            url: 'plug/replicate/true',\n            type: 'POST',\n            data: {\n                dataType: this.get('dataType'),\n                target: this.get('target')\n            },\n            success:function(result){\n                callback(\"Sharing ok !\");\n            },\n            error: function(result, response) {\n                callback(\"Replication failed !\");\n            }\n        });\n    },\n\n    cancelReplications: function(callback) {\n        $.ajax({\n            url: 'plug/replicate/false',\n            type: 'POST',\n            success:function(result){\n                callback(\"Cancel replication successful !\");\n            },\n            error: function(result, response) {\n                //callback(\"Cancel failed !\");\n                var txt = JSON.parse(result.responseText);\n                callback(txt.error, false);\n            }\n        });\n    },\n\n    register: function(callback) {\n        $.ajax({\n            url: 'plug/register/true',\n            type: 'POST',\n            data: {\n                target: this.get('target')\n            },\n            success:function(result){\n                callback(\"Ready to share !\");\n            },\n            error: function(result, response) {\n                callback(\"Not ready :/\");\n            }\n        });\n    },\n\n\n    generate: function(callback) {\n        _this = this;\n        $.ajax({\n            url: 'plug/generate',\n            type: 'POST',\n            data: {\n                nDocs: this.get('nDocs'),\n                baseName: this.get('baseName')\n            },\n            success:function(result){\n                callback(result);\n            },\n            error: function(result, response) {\n                var txt = JSON.parse(result.responseText);\n                callback(txt.error, false);\n            }\n        });\n    },\n\n    init: function(callback) {\n        $.ajax({\n            url: 'plug/init',\n            type: 'POST',\n            success:function(result){\n                callback(result, true);\n            },\n            error: function(result, response) {\n                var txt = JSON.parse(result.responseText);\n                callback(txt.error, false);\n            }\n        });\n    },\n\n    close: function(callback) {\n        $.ajax({\n            url: 'plug/close',\n            type: 'POST',\n            success:function(result){\n                callback(result, true);\n            },\n            error: function(result, response) {\n                var txt = JSON.parse(result.responseText);\n                callback(txt.error, false);\n            }\n        });\n    },\n\n    reset: function(callback) {\n        $.ajax({\n            url: 'plug/reset',\n            type: 'POST',\n            success:function(result){\n                callback(result, true);\n            },\n            error: function(result, response) {\n                var txt = JSON.parse(result.responseText);\n                callback(txt.error, false);\n            }\n        });\n    },\n\n    authenticateFP: function(callback) {\n        _this = this;\n        $.ajax({\n            url: 'plug/authenticate', \n            type: 'POST',\n            success: function(result){\n                callback(result, true);\n            },\n            error: function(result, response) {\n                var txt = JSON.parse(result.responseText);\n                callback(txt.error, false);\n            }\n        });\n    },\n\n    select: function(callback) {\n        _this = this;\n        $.ajax({\n            url: 'plug/select',\n            type: 'GET',\n            success: function(result){\n                callback(result);\n            },\n            error: function(result, response) {\n                var txt = JSON.parse(result.responseText);\n                callback(txt.error);\n            }\n        });\n    },\n\n    insert: function(callback) {\n        _this = this;\n        $.ajax({\n            url: 'plug/insert',\n            type: 'POST',\n            data: {\n                baseName: this.get('baseName')\n            },\n            success: function(result){\n                callback(result);\n            },\n            error: function(result, response) {\n                var txt = JSON.parse(result.responseText);\n                callback(txt.error);\n            }\n        });\n    },\n\n    status: function(callback) {\n        _this = this;\n        $.ajax({\n            url: 'plug/status',\n            type: 'GET',\n            success: function(result){\n                callback(result);\n            },\n            error: function(result, response) {\n                var txt = JSON.parse(result.responseText);\n                callback(txt.error);\n            }\n        });\n    }\n\n\n});\n","module.exports = class SharingRule extends Backbone.Model\n\n    urlRoot: 'sharingrule'\n\n    defaults:\n        docType: \"sharingRule\"\n","AppView        = require 'views/app_view'\nSharingRuleCollection = require 'collections/sharingRules'\n\nmodule.exports = Router = Backbone.Router.extend(\n\n    routes:\n        ''       : 'main'\n\n    main: ->\n        # We create the collection here but do it where it fits the better for\n        # your case.\n        mainView = new AppView collection: new SharingRuleCollection()\n        mainView.render()\n\n\n)\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<p>Enter your sharing rule :</p><form><label>Name :</label><input type=\\\"text\\\" id=\\\"ruleName\\\" size=\\\"10\\\"/><br/><label>Filter Doc :</label><textarea rows=\\\"3\\\" cols=\\\"75\\\" id=\\\"filterDoc\\\"></textarea><label>User Description :</label><input type=\\\"text\\\" id=\\\"docUserDesc\\\" size=\\\"10\\\"/><br/><label>Filter User :</label><textarea rows=\\\"3\\\" cols=\\\"75\\\" id=\\\"filterUser\\\"></textarea><label>User Description :</label><input type=\\\"text\\\" id=\\\"userUserDesc\\\" size=\\\"10\\\"/><br/><input id=\\\"submitRule\\\" type=\\\"submit\\\" value=\\\"Submit\\\"/></form>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<h1>Sharing control panel</h1><p>of my personal decentralized service system</p><p>Status :<strong id=\\\"status\\\"></strong></p><hr/><br/><div id=\\\"plugBlock\\\"><img id=\\\"imgplugdb\\\" src=\\\"./images/plugdb.png\\\" class=\\\"superpose\\\"/><img id=\\\"imglock\\\" src=\\\"./images/lock.png\\\" height=\\\"50\\\" width=\\\"50\\\" class=\\\"superpose\\\"/><br/><a href=\\\"\\\"><input type=\\\"button\\\" id=\\\"init\\\" value=\\\"Init\\\"/><input type=\\\"button\\\" id=\\\"close\\\" value=\\\"Close\\\"/><input type=\\\"button\\\" id=\\\"reset\\\" value=\\\"Reset\\\"/></a></div><div id=\\\"sharingBlock\\\"><p class=\\\"formRow\\\">Authenticate on your PlugDB&nbsp;<a href=\\\"\\\"><img id=\\\"authenticate\\\" src=\\\"./images/authenticate.png\\\" height=\\\"30\\\" width=\\\"30\\\"/></a><!--label Device name :--><!--input(type=\\\"text\\\", name=\\\"devicename\\\", size=10)--><!--label Password :--><!--input(type=\\\"password\\\", name=\\\"pwd\\\", size=10)--></p><!--span Show contacts--><!--input#show-list(type='checkbox')--></div><p>Sharing rules</p><div id=\\\"sharingrules-list\\\"><!--p 2/ Select shared contact--><!--#myList--><!--br--><!--form--><!--\\tlabel 3/ Share my contacts with (URL) :--><!--\\tinput(id=\\\"targetURL\\\", type=\\\"text\\\", name=\\\"targetURL\\\")--><!--p.formRow 4/ Start sharing&nbsp;--><!--\\ta(href=\\\"\\\" )--><!--\\t\\timg(id=\\\"replicateContacts\\\", data-datatype=\\\"contact\\\", src=\\\"./images/share.jpg\\\", height=\\\"30\\\", width=\\\"30\\\")--></div><hr/><br/><span>More tools</span><input id=\\\"toggle-more-tools\\\" type=\\\"checkbox\\\"/><br/><br/><div id=\\\"more-tools\\\"><form class=\\\"formRow\\\"><label>Reset contacts & create&nbsp;</label><input type=\\\"text\\\" name=\\\"nDocs\\\" size=\\\"1\\\" value=\\\"4\\\"/><span>&nbsp;new ones called&nbsp;</span><input type=\\\"text\\\" name=\\\"baseName\\\" size=\\\"5\\\" value=\\\"Alice\\\"/><span>&nbsp;</span><input id=\\\"insertDocs\\\" type=\\\"image\\\" src=\\\"./images/generate.png\\\" alt=\\\"submit\\\" height=\\\"25\\\" width=\\\"25\\\"/><!--input(id=\\\"insertDocs\\\", type=\\\"submit\\\", value=\\\"Generate\\\")--><!--img(src=\\\"./images/generate.png\\\", height=\\\"50\\\", width=\\\"50\\\")--></form><br/><form class=\\\"formRow\\\"><label>Add 1 contact named</label><input type=\\\"text\\\" name=\\\"singleBaseName\\\" size=\\\"5\\\" value=\\\"Alice\\\"/><span>&nbsp;</span><input id=\\\"insertSingleDoc\\\" type=\\\"image\\\" src=\\\"./images/add.png\\\" alt=\\\"submit\\\" height=\\\"25\\\" width=\\\"25\\\"/></form><p class=\\\"formRow\\\">Cancel all current replications :<a href=\\\"\\\"><img id=\\\"cancel\\\" src=\\\"./images/cancel.png\\\" height=\\\"25\\\" width=\\\"25\\\"/></a></p><!--p Extra :--><!--form--><!--\\tlabel Target URL :--><!--\\tinput(type=\\\"text\\\", name=\\\"targetURL\\\", size=10)--><!--\\tinput(id=\\\"registerDevice\\\", type=\\\"submit\\\", value=\\\"Unregister device\\\")--><!----></div><!--p Share the selected contacts :--><!--\\ta(href=\\\"\\\" )--><!--\\t\\timg(id=\\\"replicateContacts\\\", data-datatype=\\\"contact\\\", src=\\\"./images/share.jpg\\\", height=\\\"60\\\", width=\\\"60\\\")--><!--p Share all my photos !--><!--\\ta(href=\\\"\\\" )--><!--\\t\\timg(id=\\\"replicatePhotos\\\", data-datatype=\\\"album\\\", src=\\\"./images/share.jpg\\\", height=\\\"60\\\", width=\\\"60\\\")--><label>Add a sharing rule</label><input id=\\\"addRule\\\" type=\\\"image\\\" src=\\\"./images/add.png\\\" alt=\\\"submit\\\" height=\\\"25\\\" width=\\\"25\\\"/><div id=\\\"createRule\\\"></div><ul></ul><a href=\\\"https://github.com/Gara64/cozy-plugdb\\\">Github</a>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\nvar locals_ = (locals || {}),sharingRule = locals_.sharingRule;\nbuf.push(\"<h3>\" + (jade.escape((jade_interp = sharingRule.name) == null ? '' : jade_interp)) + \"</h3><p>FilterDoc : \" + (jade.escape((jade_interp = sharingRule.filterDoc.rule) == null ? '' : jade_interp)) + \"</p><p>FilterUser: \" + (jade.escape((jade_interp = sharingRule.filterUser.rule) == null ? '' : jade_interp)) + \"</p><p><i>Current replications :</i></p><div id=\\\"replication\\\"></div><img id=\\\"deleteRule\\\" src=\\\"./images/cancel.png\\\" height=\\\"25\\\" width=\\\"25\\\"/>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","SharingRule = require '../models/sharingRule'\nSharingRuleView = require './sharingRuleView'\n\nmodule.exports = AddSharingRuleView = Backbone.View.extend\n\n    template: require '../templates/addSharingRule'\n    tagName: 'div'\n\n    events:\n        'click #submitRule'    : 'submitRule'\n\n    render: ->\n        @$el.html @template()\n\n    submitRule: ->\n        name = $('#ruleName').val()\n        fDoc = $('#filterDoc').val()\n        dUserDesc = $('#docUserDesc').val()\n        fUser= $('#filterUser').val()\n        uUserDesc = $('#userUserDesc').val()\n\n        if @checkAttributes name, fDoc, fUser\n            filterDoc = {rule: fDoc, userDesc: dUserDesc}\n            filterUser = {rule: fUser, userDesc: uUserDesc}\n\n            newRule = new SharingRule {name, filterDoc, filterUser}\n            newRule.save()\n\n            #do this only if the rule has been created and notify the user\n            @remove()\n            @render()\n\n\n        else\n            alert 'Please enter all mandatory fields'\n\n    checkAttributes: (name, filterDoc, filterUser) ->\n        return name? and filterDoc? and filterUser?\n","Plug = require('../models/plug')\nSharingRuleView = require './sharingRuleView'\nAddSharingRuleView = require './addSharingRuleView'\n\nmodule.exports = AppView = Backbone.View.extend\n    el: 'body'\n\n    template: require('../templates/home')\n    events:\n        'click #registerDevice'    : 'registerDevice'\n        'click #insertDocs'        : 'createDocs'\n        'click #replicateContacts' : 'replicate'\n        'click #replicatePhotos'   : 'replicate'\n        'click #authenticate'      : 'authenticateFP'\n        'click #init'              : 'initPlug'\n        'click #close'             : 'closePlug'\n        'click #reset'             : 'resetPlug'\n        'click #addRule'           : 'addRule'\n\n\n    render: ->\n        # render the template\n        @$el.html @template()\n\n        @collection.fetch();\n        @collection.forEach (sharingRule) ->\n            @onRuleAdded sharingRule\n\n    onRuleAdded: (sharingRule) ->\n        ruleView = new SharingRuleView model: sharingRule\n        ruleView.render()\n\n        #append the view on the 1st ul element in the el childs (body)\n        @$el.find('ul').append ruleView.$el\n\n        console.log 'new rule added'\n\n        #@renderStatus()\n        #@renderPlug()\n\n        #myCollection = new ContactCollection()\n        #myCollection.fetch(reset:true)\n\n        #realtimer = new ContactListener()\n        #realtimer.watch myCollection\n\n        # en supposant qu'il y ait un element d'id myList dans le html\n        #view = new ContactListView\n        #   el         : '#myList'\n        #   collection : myCollection\n\n        this\n\n\n    addRule: ->\n        addRuleView = new AddSharingRuleView()\n        addRuleView.render()\n\n        @$('#createRule').empty() #In case there is already a form\n        @$('#createRule').append addRuleView.$el\n\n\n    renderStatus: ->\n        #model = @model\n        #@$el.html @template(status: model.get('status'))\n\n\n    renderPlug: ->\n        model = @model\n        isInit = model.get('init')\n        console.log 'is init : ' + isInit\n        $('#plugBlock').css('border-color', if isInit then 'green' else 'red')\n\n        isAuth = model.get('auth')\n        if(isAuth)\n            $('#myList').css('display', 'block')\n            @render\n        else\n            $('#myList').css('display', 'none')\n\n        this\n\n    updateStatus: ->\n        #this.$el.find('')\n        return\n\n    getPlugStatus: (callback) ->\n        plug = @model\n        plug.status (res) ->\n            console.log 'init : ' + res.init\n            console.log 'auth : ' + res.auth\n            plug.set init: res.init\n            plug.set auth: res.auth\n            callback\n        return\n\n    replicate: (event) ->\n        event.preventDefault()\n        plug = @model\n        dataType = $(event.currentTarget).data('datatype')\n        target = @$el.find('input[name=\"targetURL\"]').val()\n        if target is ''\n            alert 'Please type the target URL'\n            return\n        if not plug.get 'auth'\n            alert 'Please authenticate first'\n            return\n\n        plug.set dataType: dataType\n        plug.set target: target\n        plug.replicate (res) ->\n            plug.set status: res\n            return\n        return\n\n    cancelReplications: (event) ->\n        event.preventDefault()\n        plug = @model\n        plug.cancelReplications (res) ->\n            plug.set status: res\n            return\n        return\n\n    registerDevice: (event) ->\n        event.preventDefault()\n        plug = @model\n        plug.set target: @$el.find('input[name=\"targetURL\"]').val()\n        plug.register (res) ->\n            plug.set status: res\n            return\n        return\n\n    createDocs: (event) ->\n        event.preventDefault()\n        plug = @model\n        plug.set nDocs   : @$el.find('input[name=\"nDocs\"]').val()\n        plug.set baseName: @$el.find('input[name=\"baseName\"]').val()\n        plug.set status: 'Generation of the documents...'\n        plug.generate (res) ->\n            plug.set status: res\n            return\n        return\n\n    initPlug: (event) ->\n        event.preventDefault()\n        plug = @model\n        plug.set status: 'Initialization...'\n        plug.init (res, init) ->\n            plug.set status: res\n            plug.set init: init\n            return\n        return\n\n    closePlug: (event) ->\n        event.preventDefault()\n        plug = @model\n        plug.set status: 'Shut down...'\n        plug.close (res, closed) ->\n            plug.set status: res\n            plug.set auth: !closed\n            plug.set init: !closed\n            return\n        return\n\n    resetPlug: (event) ->\n        event.preventDefault()\n        plug = @model\n        plug.set status: 'Restart plugDB...'\n        plug.reset (res, reset) ->\n            plug.set status: res\n            plug.set auth: !reset\n            plug.set init: reset\n            return\n        return\n\n    authenticateFP: (event) ->\n        event.preventDefault()\n        $('#status').html 'Authentification...'\n\n        $.ajax\n            url: 'plug/authenticate',\n            type: 'POST',\n            success: (result) =>\n                console.log 'auth ok'\n                $('#status').html 'Authentification successful'\n                @render()\n            error: (result, response) ->\n                console.log 'auth nok : ' + JSON.stringify result\n                $('#status').html 'Authentification failed'\n\n        #plug.set status: 'Authentication...'\n        ###plug.authenticateFP (res, authenticated) ->\n            plug.set status: res\n            plug.set auth: authenticated\n            #check if the authenticaion failed but not the initialization\n            if not authenticated\n                _this.getPlugStatus()\n            else\n                plug.set init: true\n            return\n        return\n        ###\n\n\n\n\n\n    # initialize is automatically called once after the view is constructed\n    initialize: ->\n        _this = this\n        @listenTo(@collection, \"add\", @onRuleAdded)\n\n        #@getPlugStatus () ->\n        #    _this.renderPlug _this\n        #@renderPlug this\n        #@model.on 'change:status', @render, this\n        #@model.on 'change:auth', @render, this\n        #@model.on 'change:init', @render, this\n        return\n\n    onInsertPlug: (model) ->\n        # re-render the view\n        @render()\n        return\n\n\n\n\nclass Contact extends Backbone.Model\n\n\nclass ContactCollection extends Backbone.Collection\n    model : Contact\n    url   : 'contacts'\n\n\nclass ContactListener extends CozySocketListener\n    models:\n        'contact': Contact\n    events: [\n        'contact.create'\n        'contact.update'\n        'contact.delete'\n    ]\n    onRemoteCreate: (model) ->\n        @collection.add model\n    onRemoteDelete: (model) ->\n        @collection.remove model\n\n\nclass ContactListView extends Backbone.View\n\n    events :\n        \"change\" : \"onChange\"\n\n\n    onChange : (e) ->\n        console.log e.target\n        e.preventDefault()\n        if e.target.type == \"checkbox\"\n            model = @collection.get(e.target.id)\n            model.save({shared : !model.get('shared')}, {wait:true})\n        else\n            @handleInputChange(e.target)\n\n\n    handleInputChange : (elt)->\n        console.log \"handleInputChange !\"\n        parent = elt.parentElement.parentElement\n        firstName = parent.children[0].children[0].value\n        lastName  = parent.children[1].children[0].value\n        note      = parent.children[2].children[0].value\n        data =\n            n    : lastName + \";\" + firstName + \";;;\"\n            fn   : firstName + \" \" + lastName\n            note : note\n        model = @collection.get(parent.id)\n        model.save(data, {wait:true})\n\n\n    initialize: ->\n        #@listenTo @collection, 'change', @render\n        #@listenTo @collection, 'add'   , @render\n        #@listenTo @collection, 'remove', @render\n        #@listenTo @collection, 'reset' , @render\n        #console.log @el\n        # @el.addEventListener('blur',@onBlur)\n\n    renderOne: (model) =>\n        #console.log  model.get('shared')\n        checked = if model.get('shared') then \"checked='checked'\" else ''\n        n = model.get('n')\n        if n\n            n = n.split(';')\n        else\n            n = [model.get('fn'),'']\n        #console.log n\n        id = model.get('id')\n        \"\"\"\n            <tr class='contac-row' id=#{id}>\n               <!-- <td role=\"id\">#{id}</td> -->\n                <td role=\"fn\"><input value=\"#{n[1]}\"></input></td>\n                <td role=\"ln\"><input value=\"#{n[0]}\"></input></td>\n                <td role=\"pn\"><input value=\"#{model.get('note')}\"></input></td>\n                <td><input type=\"checkbox\" id=\"#{id}\" #{checked}></td>\n            </tr>\n        \"\"\"\n\n    render: =>\n        html =\n        \"\"\"\n            <table>\n            <thead>\n            <tr class=\"titles\">\n               <!-- <td>ID</td> -->\n                <td role=\"ln\">Last name</td>\n                <td role=\"fn\">First name</td>\n                <td role=\"pn\">Note</td>\n                <td>Shared</td>\n            </tr>\n            </thead>\n        \"\"\"\n        @collection.forEach (model) =>\n            html += @renderOne model\n\n        html += '</table>'\n        @$el.html(html)\n","","\nmodule.exports = SharingRuleView = Backbone.View.extend\n\n    #className: 'sharingRule'\n    template: require '../templates/sharingRule'\n    tagName: 'div'\n    className: 'sharingRule'\n\n    events:\n        'click #deleteRule'        : 'deleteRule'\n\n    render: ->\n        @$el.html @template sharingRule: @model.toJSON()\n        console.log 'collection sharing rule: ' +  JSON.stringify @model\n\n\n    deleteRule: ->\n        console.log 'id : ' + @model.id\n        @model.destroy() #destroy the model and request the server\n        @remove() #remove the DOM element\n"]}